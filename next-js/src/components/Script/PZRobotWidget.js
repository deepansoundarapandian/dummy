import { useEffect } from "react";
import Script from "next/script";

export default function PZRobotWidget() {
  useEffect(() => {
    const storedAgentType = sessionStorage.getItem("agentType");
    let agentType = storedAgentType || "agent1";

    const select = document.getElementById("agentImg");
    if (select && storedAgentType) {
      select.value = storedAgentType;
    }

    const privateKey = `-----BEGIN PRIVATE KEY-----
LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRd0lCQURBTkJna3Foa2lH
OXcwQkFRRUZBQVNDQ1Mwd2dna3BBZ0VBQW9JQ0FRQzdGbnRzUUNubG9ZUDcKWTM3
cFVoU05oMlhLRlpHSmE2dlduMklhdUFkS3VUWDUrdkd5V1JNcWppaG5qY2t6YUMw
c3pJQ1d2LzBMeU1jYgp5YTJrWmNISENGdDNYdmYvNWVWaHY2aStBQnFUWUl5cm1k
aHZjK1J6WmliVHU5cDJKdU9zWE4yVEpvdmhQM2hXCmt4THhwNzhvcFU1SmhySlYy
c25nb0hyUzRLZTBBSHZUeVVTYVVJeEx1WHJYL2gxODFIL1l1eXJQbXZkTnJxN1MK
NlR2NEI4N1lRVlNHMVRNTlNoU1poanhwTmorNG52bEVscFBtREFYTEZzUXR2bFY3
dE5pQ28xbHE5cmd6cUF0ago0S0FXa0h4dlczbE1ndGxRMzBnTjBQUmFwcXhJYWhO
NENRRWVOdVhhc0dCb3BDOHVTTjhjNmgzaWprZkJWS2VwCmZTU0pZTFR2ZlJmSlJ1
enBVTzA3U1VsZzVsN3BubDhXeU81OWlPOFZkK1VPRXJlUkgzVVhBM2FKbTNoWlNz
M04KYk0xQkIrS2U3T21ydSswc1p3aUs4bXlSclFZdytMWERZNDJUNGN5czVuZDht
d2pTV3BxaTAxWmRyWmRIL0l5MgpjdzVXMGt2THJVQU9TQjd5Y0hjWEZzNEZNK0Jj
eVI4VkVVTTliK3Z1dU9vY2lDZFpkczhSQ21YN1BpZ1JqVkZ3CjJ2ZXFvQjMrM0JR
L1lYOWtzSDhYbGU2QzYvT0hZdWljRjFNWlJtdmllVTFxMnE2K0g3TWVzdWJWNldP
YnQxdGkKVVVxSkJmc2UzL09aa0tuV0VQUG9LbHdVcDFVWmw4QUowMkY5TDVGWVov
WnczQ2J1ejB2YUc1UVk0bGZQSmxuMQpUQVBLcmo0SUdTaVRCd2VpQnBIeWhDZ1U3
ejgzd3dJREFRQUJBb0lDQUFaSzhoVFI5L2JMK2xWcTBQWHEwdTI1CkxEblA4bFp6
bWk1RjBFaE1OMVJKZEdEVEVxUDZrcGlJNk5iY2phcmVmR0tCY0dxcXpLVG9VOTlM
QzRiS2EybzUKbjZxSy90cWRhUzVpM2dTaUNCNDc2YUduSUxmQytjM04zdDhzdjNW
eUVDTE8wMmcvTENyZlVibXJ2M2E3T3pKdgpsR2N0SkhOMlpSNWFsNEFvZGQzZzM3
Y1d0bnZMdG4vRlF2OHBBbE1MZkwwVnNwRzVOeWRCOTBENVNCRXJCaENSCm9XY2pV
Mk15K1F4RGZJcEZJVFpGMzhHRHhSTlNsM3k0dzlCWGdGMlRNd0RWNUNmK1lrOEZX
WjFNbnh5M3dZKzUKbUxpRjRuanhyMlZCU1lFVFcyU1BTeDlaUWkrVk1yT1ljMGto
d2NPbUk3QXRnSnJVa25TVXhVcWtvMG9LeUMxdwpzNUovbVRSaUdwOEM4cXFxamVt
TCtaRWcwWkNvSzRWNTQ3WlhJTGNFckcrZEN1WHJCeThGdWZ6K2xhUFZOUHRmCnZ0
cmRydVMzSnkzZVV0TDIwa3N3WXkxeEt3V0pPYWhkbzAxVEpDOHo3eFJDdVpCRjdx
SDh5SXg0WHE1Y3hXM3kKeFRwaHFGWnhScDlRNWp6M05iNEtxL2g1RExqUXFDL2t0
bXFGVWdWdG16YW1HSURMeVdHYms5RUh6bHVlY3BwQwpMTzMvWExUSy9Hbm9DZFJK
dktOV3NtcEY1REZ4VzBkRFZGckFFR3RCVm9LZUxtcXNJdXFmWlB4TDJrQUV1aEtt
ClpKaGczOHBOVVFuUGFRN2laNHlYTWZpQlRHaEFGOE5Hdzc5WVYyOUZBdzNMUXpy
TGlGV3dWL29STVNFRjlDeVMKaTlGUHpNYzE3L2xvU2tFMEZKbTFBb0lCQVFEaW9z
SGZCTzJVWVpJRXkzd1diWVlJWk45SmxPdm5abkVrRmtOcApzKzE1dUV3MkJxMjN1
UG5hV2ZHcENEUnJxb2Mva2xjRTE0YTlTWkpOMjJPYmx2aU93K0JEeTM2Y3hYdmpN
MTl5CmRnOSsrcGIxQzBNdUNNN2F5OXV4YlUwaCtMbFB4MjVjY1kwZEdGRGt3QXI0
QVdkemhtM3BSOWI0bWE5ODJ4b3cKczNCdFBIM3FaNTY1U0k0VUk4RUJnL0RmcWND
TFM2bzJoVmxhNXNoUDhEOVJxQ1UvdVhuRVFEcEs1QVZCL1h3TQp0MzFPcXp2TW15
akE1YUV5R3hPWUF1citoMFJoQXR0TFZoTTBWbzB2TG5DS0xTcThiZlNBdzhjczdQ
OVVudHJaCnNQNWpXeEF1Ui9kTjRiQ0NBUllGb2ZsUEhyTE1zUnR1eWdFRHU3MWUy
alN2QTY0VkFvSUJBUURUVS9jMzlmemwKS3J2NVArbzZjZWR0WGdGTkhjRXRVQ1I3
bnFjR21FeFlMcDZkdXNVTGRqUG9hdGxady8wZnlXN0FQR3k3MjM0VwoyNE5EdlRQ
aC9TSnJMZ1hURUh1V2Y0dUx5M3J6aGlka0dXWm1rbHdwL2xvMVpHNjJOcnRsTmRC
UjUxbElmZzlLCloxKy9IaFBoYTQ4RGxvTTRBS0FaV2pKQmdYK0R0aDU4UzgrNEdD
d1hRV3NPa1h1aUU5dVJ1ZDNSVkhRdmFub1AKNGVydVpJNTFzakcrMXc3NlFJT2pQ
bFJRcnAwc0RDKy9pL2Ywb2xRK1VKMXJmWHEvdUVQcm5xRSs5cm5ObjZSdwpYeTBP
WjhnUHhGRGFlY2Nac0FWdit2TDFMWVFxR3J5SVgxSWRiSG5hUGg0WlFnVlNnT3Fy
dVFoellsc0xtK3VBCm1zWUVRTyttUXh4M0FvSUJBUURobzh2RDRDTXQ1UXE5RFY3
bzhYaE5xU2lLR09QYUNpdEJFNDFna3d3dmNLY24KN3ZSTUE3VjJpTEJLYTJuTmZB
V1Y3SHdJelJCUUt3eW55WExkZUt6VmJ2MDhZa0VYa3FMcXJMNHR0bzl0Qzg3NQov
NUdPSnFUVVA3em1aSDAwQW05MWw0Z3dMN21nS3hKMi9TQ3VsSzlMM0o1WGNQZjlv
UDJRSUpCdHhtbDd5SXRRCnNvUGIwdm5wNFVNSzRETVVhK3pRZ3EvZ0FsblpZQVkx
V0d1aVAvZDkvNHJWTW1FWEtQaDNJQW0rbTN6OXN3d2gKaEtWSmtCWXlUYlR2VnBC
aWc0ZzMwZUZGbTFnWmRzYXdIOXRhSnVmeW5NS2U1TXpMMU5YTmlTODVKN2ZPY2Q2
bApSVzlhTWdaTEdRdTA1ZlBTcXl5M0VPblFIdnh0bkNCSmJKU2hYdGVWQW9JQkFR
REI1alRiSDlVZTRBc0JNMmZTCm9GaGJ2UGtzckxSbXd6WDJSeWV4b1dQTE5WdE1G
ZVplRWVLbXlnTUxuZ3hPY2lBd09rRDZUUFp3T3BGQ1FnT3MKd3ZvbHBXQ3F2R0Rw
UWJYa1dwdEJma0grVWwvbWxUd0RPK0hCUTVsaGp1NTZldG5kakl3Yk82OEQ4YjJr
T2hDNwpzRmpVVGZHd0hNTEpBRDFFWlhGK2hFZU1mSExtMHljQlg0Qy9LVFZyRFJW
VnJGaWVqUUxkenJDWWlnMXBGdEt2Cm93U0p1Z0dBRkZtMEdxaDZMdnovUVY4K1BV
c1JKekJzek1ManNZcERCdXNxOGEyNWUrQVhqdmJ1TkNXL0pmSW0KcFZZYVg4b1RB
N0s1Z0dRVUdlTStUckhWM3NBVlIwYTJ2SEFaZEw0MWFSdm8zQ21vMVFIOHNOOXdi
SkpyckxrMgpzRFVaQW9JQkFCR0tITmVpS2o2ZUovWkFZeWtqTWpieUsxSjdiU0JO
KzVLYWM5TFBvKzBVRGNSbkR6dmhTRlkwCks2VTFldFJtUVI0ZGthUElLeFhtT0k3
eDNKR3BMRW5COEpRQ0U5bHNTS2NZUmdFckZiMlBHNVVQaG5TS2xnMjEKVVhJSGFn
Nld5bjZJdnlnYlhjalRRQ0dpK3JjbVdJSHE5cmdlcnltU0VoSWhuLy9iejdwcEFX
RE1ZQ0FZSCtRQgo5QnZlaVptWnFZNjByVW9TWGNnYlpCWmdqVUljdlZsdGlTYTRN
SmhFZ042OXNRQlhvenR5bCtEdkpZd3o5YkhxCnAzZThCT212Ulh4R1RPdlRqck9z
TVIrcS9JUkwvdEZkQytXbkNaeUtRMnZyaDdSK1MwZ0pPZFdNL3R4V0xPS0kKaG1i
QzVlc0N1TDZINmlVdDdXVG1teFdzZzA4b093MD0KLS0tLS1FTkQgUFJJVkFURSBL
RVktLS0tLQo=
-----END PRIVATE KEY-----`;

    const options = {
      client_id: "1",
      username: "username",
      privateKey,
      validate: async function (result) {
        return !!result.access_token;
      },
      onclose: function () {
        console.log("Widget closed");
      },
    };

    // initialize bot only after external script loads
    const interval = setInterval(() => {
      if (window.PZRobot) {
        const bot = new window.PZRobot(options);
        bot.open();
        clearInterval(interval);
      }
    }, 100);

    return () => clearInterval(interval);
  }, []);

  return (
    <>
      <Script src="https://pz-script.vercel.app/agent/agent_script/pz-robot.js" strategy="afterInteractive" />
    </>

  );
}
