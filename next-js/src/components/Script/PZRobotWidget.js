import { useEffect } from "react";
import Script from "next/script";

export default function PZRobotWidget() {
  useEffect(() => {
    const storedAgentType = sessionStorage.getItem("agentType");
    let agentType = storedAgentType || "agent1";

    const select = document.getElementById("agentImg");
    if (select && storedAgentType) {
      select.value = storedAgentType;
    }

    const privateKey = `-----BEGIN PRIVATE KEY-----
LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRUUlCQURBTkJna3Foa2lH
OXcwQkFRRUZBQVNDQ1Nzd2dna25BZ0VBQW9JQ0FRQ3A5MzI4T3pjRWxhNE4KT2sz
YnFVRTQ1QmdTZ0RKWVB0ZDYxOWFndXE3d0JUU3ltSG9rYW5tTitvNzJZa3l6VkdQ
MER2RUlGbjI3UEQ5TApORjl0ajJaSjF1dE1zaDZ1M1Z5cmlMd1lhTWNtTjlGdU5P
RnorcVduU05IYjFpakwyb0t0cE85L1dUUUFvclQ5CkxXSVdVR2UzTVFLYXVzZlA4
N2VmS1RLVE9TblloVENWbDdEZmRhMVcvcVBQUnMzdlh1UU5KckRYL1RReDNHT2EK
OWc5bjVjZkN1amhQZnB5a1QyOEg4MmEyL0w4aWRPUWtwdEhmcmJkTUt4c2ZIK3ZO
NGZSb25uakgwbGMzekpzSwpobGZlVEU1Q2diODI0eVZSSmJlU09nZ1ZyYm4wK2Nh
NVBpR1pneEdKeDdxbzI5aUYvQXMzMnlIYnJiRm1xMXNSCmxVRmc2UlhRQnMxWmg0
dExwOUl3OUdabnhJU1BmZm44U25zRTB6eEhRMjhUeWhvUFZkYkcyeDUwSGZFRUF5
SngKWVpjQ0xPMFY3S0VTZmwvUFgzenlwSlhwdkQ3MzZQeE1LTTdreEhKYlREeDA2
eUlYRnh1SnhOc2krRUJab1FXWQpuYWR1UWR3aHp3dlBlSkFJMlhyQmJ3REpFbEZ0
SkE0bFpsZ0tDSGtzSUU3MldCVzlKajFJL0VoSlV0TTlOT2ZJCk9UVFdER24xTWJC
ZVlMUDFFdkNmMDVTVFUva1VqMzBlRWlFZUQwaVFnbjFjR0pGZnBtOEVLSXF2MWRE
M2JvQnoKd082Z0c5RnVXRXJ2cmR2d21ZN240RXRMeHZYbHJpK3dUVUJsMDc0M2U1
cHk3ZkVxVSs3WDZVclBPK2tNQ2pnUQoxVGZuSFBkbFhKTUVLUHVVN2kvY2tITHY4
MzFpaFFJREFRQUJBb0lCL3p1SUh0ZDU1aUMwOTBHcTFPL0dBMmVVCmZObitEUG1H
WHAyb1VTOVFNL1hkM095eEpoYndpYUxieW95QjRiRHVNMm1kMGlRREVnYllFMU5F
Qk5OYkVYakwKZVBSa0diQjdMYVRuUDZWTkRjbFZHUVhXS25iS1UrWHVtNUs1eFpC
TCtNN1pTN1JQTk9ldXdHQ1gyaGloWmwwWgpJdEJrbTVmbGNCWDZBcnpqbmhuak4z
YURWY1daeDNKYnZsbmJjdkM1OW52NkVVeEFZN0pvZnlWeVgwaGFNMGhXCm5BMDc5
a3hCaGt6dFNXSWp6M2xDSXFhengzbVJDYUtrSVRFYS9TZDAvU1pTVzFEM1c1VXZ2
OGp2NzliczR5Y1MKOVpGRC9pTnVFb2pQeXEvTkthcFBKNkVQekxUNE00RzVjMUpj
V1NVL2VBUERFbTQwdlpqakZxMW5SSDhDZWt0Ngo5ZGh1Vitub2NxK01LQTJyb1dp
b210c05LNUVCSkpsYWhGbFlsekI4cmZJVzJGNmVwWlZJcmhGRW1SY3J1VzFvCkp1
U3Q4endoMnI2d0xEQk90WWhlZ0N1Vi9rbmRmbVBiVGRMMWdTY2VrTk5zWHc5WFdO
N1dtNXhQTURkcnNSN2YKSzh3SmVMbmY3M3pUMzZPUGk5V3I1cm45US80VE9KUCt5
UmFzZ1Q5Rzd3anVmYnRzbTdLVFdsNzhFbFpYaTlwbgowLy9mWHpSdTBaS1JiZWtK
WE9RVTYxTEV3cjVkTWIvMkQvOU1hM25XbCt3ak8xc01CdGttdGY4L0owdHNNR2lQ
CkhCNk9tZTI4SDArUkNjWHkrMUFPR0dqOFRlT0Z2encrWUZvRXp6SjFtWkQwcXp4
NGVaOHEybzRCMHd3azE1U3QKdXZjdXlPVGlYWHRDMXM4ZERtRUNnZ0VCQU44N1Iv
UXllU0Fza3dMd3J0bUwvbnEyMFhLaG9vWk1FL1llcnVVZAprL2srNUNZeE9Pb2oz
anR6dnZseG5Gekc1SXl4REdlazJtTWpwOVVWQnhMSFJPWEYvM0w3YjhlUjFjbXBL
c1lNCnRQTWtNL2hxSitmMlBmaGhKbnhRYXk5dkxVeEIySTRweWtUdFQ1Z2RVYkM0
c04zUEY1ZURQakQ5TlZndHdiRncKMFJ0OHhDMisyMVpzNm05L2dCc3F1ck8rUm9X
NmFuMW4xUUtRaHNXZnFIejNTREVYWmJKTy9KYURMMzl1d3RIQgpoTmQvbUlUN2FV
UHo3dVBZb00wY3RPZE5nK2ZLcGJONFVXbkdNV3NlaitMWm1JOFZIdG91RDNFV1Zt
eDJJM3dSCmR3MDhGM2VVdWtXV0JvV3Eza0xtQVllK2ZKSmJhczhENEdRRGxDWDk1
Wno5NGkwQ2dnRUJBTUxxbUl3bFprWG0KaWZpU2RkZmpaMFB2MnU2ZGtXSzBiT05Z
MjByODIwSlNJVG5PYTF5dEtjalZxZjJQNmMzU3BDY1dMMzMxUU9KbQpBOG9IYkR4
Ukl4WW1mQXYyRTE2UndXcTBqdDI0d0hwcm1ISnJ5MWxibGVVaXNEbTByWllFb1E3
TncrSUU1Z21mCmNaQmluRFZLaFdoUEREZUpxb01ncEZJSkxLMkQxc2Fxc1BmY084
bnc2M2M1elZiVDVOOHdYQU41RkNYT1NKZHkKS2dnOXlETjl1UVNIeHBiSEp0TmJh
d2xOaHgybW9BVDdoaG9VRFovL2w3eHpEd2RnRTI4VzlLemhVMzZFZnRKZgo1ZnBk
UURXejBrQXk3MjhnK0tvZWxBQVNicXhxK3RZSFlLUnVLSXlQcWpucVRaMmIrTFR4
WGtNa29UYUVWVjJuCjZHbUt1b2hlc0xrQ2dnRUFXUTB0QngyYmRGcFR5emg0aUJC
dzFFTmFDb0N3ZFNLa1UrcXBtbnpTS3Z3THg3Q2IKSTh4ck93eFJndkR2ajVOSVdW
Zkh1eERvamVRTGI5V1RuTW9oa2dnS2Y3UU9RMjdKK2tpaDU1L3FENVRCcHJleQpj
N2Fud2czL2JGZ29haVBQemp2MlI4QWtFSnNheFhQc3dyTHEyNUZodCsrRFA4ZkRJ
QW9nMnNoR290Q0M4anpSCkF3a3YvSXJBY0JYN3BQaWk2WFlVUlRMR3B0OUE1RlZz
d1cxa1B6RTJRSXVCK0FrZFNaakYzeWR6OXdQUHREMFgKSVNTT2lCWkRENUFFR3NH
eGZTWTZNLzRyZkNhMFVDZEEveDRPM2dWdTZWcTJqa1o2ODRtdFhqRVpiUTRyem1o
bQpacHdTdmdBTDZtUVcrQy9sUWYxMS9sOXRoSGhwQVQ3bitsak5nUUtDQVFCc0cy
dkNoMWZETzB1WTk3cXVvK3o1CmpFWVVoSVpIaGFUREw5eHBLZmQrUUVrM1k1cStp
emlhc0k4WkdNSG5xNFhxTys3WllMYTlHekhNMHZNZ1BTeEYKczlDblhiTitoejhN
ck5wMGRXMGtPUnNUazEvMHpzeERpMHJNcHI2RWIwclpDQjAxOWR1VXlMOVhBcXA3
RURzUQpFSS9KR2V6ZHo3UHo0Q3pNakV3S1lrL0hHWHA3MWNqemxyYWlDdUp0Tzhn
OUVPR3cya24rM1k0Y2hnL05KMVVBCkEwS05EQ1lub2hPcTFEbzFvdDRzQlVscW0y
YTNNQzc3a2FGclNNbGVtdy9YOXgyMUZVMjE1d1NLS1VCY3lNQzcKWk1UU0VTcDZT
SDF6ME1WYmtmWlAwVVd6elhsbUJLUzRmSkRSOHRrdG1wWGFqYTF3ckZNZ24rbFM2
R1B2RVAzWgpBb0lCQVFDbUZ2QXlLRzloQjJYOEtHVmp5NEVFeTJvR01UU3ZiclQ3
Rm1uYmgrU2dsQ1N1NkZ4RmNOVjRlWW9VCnd1dXVEMXRjWERrdU9teFAySWRpakt3
TGRCclZyWlQyYWZ1aWxlNGFxeUFtR0s0UkdXbGVmb0pOUHBmOC82Y1UKMEx4WXVG
ZVZ4NVBWaGczMVVKeVZPd3BxYTlKQ2doRFhnaGdLWnVFcHIvVUk4VzBFR1BDenYw
NWNBT01rVVRVMQpFdVdMUllaRDZadTN2bEYxL0lIWDY5Z2dpTnhyUVc4TWRpdGZo
bXBvSy9QTU4rRTAyWUVwSXhQRzNJQnRPVmJKCjZSMHI2dG9jNmNsa3FrVlh6OUVP
bVkvUEVVbTlIRE1mL1RzYXhZdmp1Mm5zTU9TaE9qVkQ3Vm1JNnkzRWJLc2MKRnMv
SEZuQWJGN3hrenBGeHJWTnV6cmczTVkzRwotLS0tLUVORCBQUklWQVRFIEtFWS0t
LS0tCg==
-----END PRIVATE KEY-----`;

    const options = {
      client_id: "1",
      username: "username",
      privateKey,
      validate: async function (result) {
        return !!result.access_token;
      },
      onclose: function () {
        console.log("Widget closed");
      },
    };

    // initialize bot only after external script loads
    const interval = setInterval(() => {
      if (window.PZRobot) {
        const bot = new window.PZRobot(options);
        bot.open();
        clearInterval(interval);
      }
    }, 100);

    return () => clearInterval(interval);
  }, []);

  return (
    <>
      <Script
        src="https://d3ciu0yrrqiblg.cloudfront.net/ira_cdn/ira_agent.js"
        strategy="afterInteractive"
      />  
    </>

  );
}
