import { useEffect } from "react";
import Script from "next/script";

export default function PZRobotWidget() {
  useEffect(() => {
    const storedAgentType = sessionStorage.getItem("agentType");
    let agentType = storedAgentType || "agent1";

    const select = document.getElementById("agentImg");
    if (select && storedAgentType) {
      select.value = storedAgentType;
    }

    const privateKey = `-----BEGIN PRIVATE KEY-----
LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRUUlCQURBTkJna3Foa2lH
OXcwQkFRRUZBQVNDQ1Nzd2dna25BZ0VBQW9JQ0FRQ0xuaU1tOENjNnNmOTgKTVE0
UlV6Q3FwQ0FONzFRUFlxeE55SzNVQUR2QzhKYzJFQ3kzWDZjNVNEQ3llK0Jld3k5
NklKZnh5bXU4Ty9sbgpDdnR6WTJlZzA4N0Jub2tZbmdGcUQxYVY4QmlGZyswbTlj
NVRIZFJWbGdvb1Q3YVZrbUl3Mlk1bXg4N044b1ZHCmgxTVhZS2l4YzFDKzZuSmk4
YU5QZlR4dXU3MVlmVnk4c3p6WndOb3JIZXRodkZ1QTBKNThjRjc2dm14eTlReWEK
Q0hDZk9Xb2FybXB0eFF3ZzluNzg1a2lXYTFDWVB5aDhwTFJ4TlFjcFJxSC9iYSsy
My8wT1ZXWWVmbmc4WDhlUAptQnBjQ0FLSnlHd0h3VktYVy91d1gxTXFRdEpUTzNY
Z283Mm9hdFJ1aVdiQmZkVytqMzFUa2JvUU0wZzdIb3o1CmNYR1Y1VEZZdURMbkIw
cFN1M2pTNTZKNUYrRG9VZUF6dGhxOVRmTmhKWE9WQjBDaVNhRDJxQTFnR1phK1Zs
TGkKVGtLSm5COFBKYjM2MGJkYjVMdlNsN0NrbGw0MENULzZibXpESDEzZGhTNnV4
eWw3VmhpSzIvMjk1d3RGYk9IYQpxbUhvRHQ3eWk2VktOTzh6N2EyWWlWczNFWTJN
OG0yZzM3aTJObFMrK1RPeUlFK2RLcDFNZkt5bmpEL005emNICjVOYlJLMy9sRWJG
YWovR0NhRHdQYTczNWZQVEdNa3Q5MElER1VTSXlNTXF2U0ZrOERlNFE0TWFXdnJU
OXJHVFcKbWNaazhVQWdmY01zaWFtREE0TFI5TG5xbUxtVmttMHpaeU1qV0RSeFhM
a2hWM2NKdDdHc2liM05KTUdDN0R5ZwpDb2pXZXRHYUxveTZxMXVLV3kzMXBkdG1u
bk1MQXdJREFRQUJBb0lDQURZQ1RvYlpqOU5jMkFBcTJjNUo2Q0dhCnErdTRFVVND
WHpVWDFHYVdVSWZ3bWc0SDQ4UnI5RHhzZUtvUzBaRFc0SjdWelBGejVJbEVpZzRh
YVhzUmtSemQKMHJXRHBuVW5hbFNrNmxIR056WXUrcVovbi9qM0tSU1NuZ3RLQ3Mr
QmVRcDhubUdVR2FRQmxSemJiSUUybXd0SwpHSXBDRjAyL08vV2I5S3pCWTFXLzZR
ZjJMaXZ1Tm5kSGM2NnpOcEoySVZqeC8wdndMZk9xWjkyT05rTGg2dkczClZ1UnZ2
V2xpOFd6VGlIRG53cDJpa1A3bW1BYlRCSm9yQUsvV3RvcC95MXlvSElEZlc1Ty9X
V3RxNDRlR2NiVHIKR3g5RTRiWTdsdmw3WnFpS2dPSkJ0aS9ZSjUzbTlaWnRBSnNK
R281RTQ2NVlTU25MTEwzeDY0YnpJNFZneTkxNwowYTFMV2NOREM3cDE0WTA3MlBN
Vm5uOGROSURyQk1WZVdpT0JNNkE4RjBsemhTT0xtZGR6MmF4WTE5akdHZDNXCmVW
L2RNQVM2SDQyYnF4ekdpZUtyTThLZTJ4OFVSbGNyQzNkS29pY0hMblcxN2hZT1NC
OHZJdVNvVkErRlFZb3MKRzVqeEcwcUl3T2NrazVCbTRObWltbzdjSG9uUmltMWx4
eVcwdFh6R1c5eVNBK1psU1djM0h3dlF5WkxYRUtZUgp6K1hrSHJwZWtITWV4bTRU
RjYxbFZXQlJpSXpzSUxBV2lFOWJ4bGR3VktMazE0M1dLKzhHRUxxWThpdDZmZEV4
CkdJUHI3Unk2SU90Z2cxbk1RWUhxb1AxNmE4RXlKV0pqMzA0dGp3bCtZMnAwV2JH
TEhjZmtnbk91dDJqcWtWc1YKcUJldW5veS9lbVRvQmU0cUZ3V0JBb0lCQVFEQ0xr
S2NDWXFsUlJPMnEyK0lWSWE3bjdGTlNnVmxoRHJNaWQxZAp0NlpNK0RmWC9iZFYz
bUtrdEl4RWExaW05M21KaHFPZVNIK0JDNHlvaEpqVmZlMWVFN3hFUCs5VlJOMncr
eXVkCkNLcXIvQ0lPWHBlR3JrN2dPR254b2NWVkZNS3l3bkk2RHpHVlRxVDNMK25i
M0pyV1NUYVpWOUtmUWtnbUlJa2kKZ1M5L285TkRRK3VSZXpBR3U4Ylkralc3b2Jz
L1pJR1BZbEJBbUpLekFyQnNCUllJOU5UVHlvMm9oeXZaRmVGbApsM3NVN05Hanlj
L2JYeVNpRGRqTHU0UFd5d1RiMW5zRkVZNFVEb3BuZFk1QnpXRXZOVFYvZEFGampm
QjArSW9RCnU2ckUvMHN4bGUrQnFhRHE5Q0E3R00vemRnV3cxbnlqVFBsR01JUDgw
VUlXU2hlYkFvSUJBUUM0RVAyaUNIMTUKMFRlZk1WUzIvUlZzWkFHR0dsU00yWjRK
R3RDQ2NmSmdialByVEpRb1VpTXJXTE1URnBiWVhvNjlnYTFwRXVrMgpVNG1ZK0VL
QjRSSloxek5rN1VXeThHbGwwMXVFL25jNWhvSWY1cG9zcmtHRjc1b2hjQUEzNFhW
RFlVeFhGZ1FVCjRmdFovM2VZam5KRzZpZjNQT0Y5TGNlR05HaEpPWnlrL1h1clRz
eUhLNUM4Wk8ydUxpazBOdzJhZi94czE1ZWwKSlhNSkdEZWFEQW15NGgxVE9KNjRk
b3ljY3I3UnAzZU9BZkVHbUpSWFVqMnM0SG9JRTdpQTRHNUl1UzhydU9qVApYWnJT
L3NpWG1KejFrVUZub1pyOU9rb3o2Y1R6T3hrRUxWS2s4Q1dsaGdvMkxBL1ZkdzZx
OWJ5bVpPdk96TWFVCmVUMUo3Z3gxWGJTNUFvSUJBQ2U0aXN1Y2NBNEtxVk91a2V3
VFRsUkhBRi9OQ25tUHFPOTZMQndsbXhFWG5XVEQKYzZOUEVHS2N4Q3lpd01tMnlk
ZkdBT1k1OGtzVmI3cHhGVXBtcmcyV2YrWitKWmtOczBPbXZXOHIvSzJkcitHOApt
OFpqRmFOc0pzL1V4YWIzempQKzdwck56Tmk3ODZiVTJFT3ZSc1VheU41cFJwNXBV
cFRxQnVOV0JiOVlaYmpXCnhmTkdmYmFDNXRRdnFwb3RKVDU4Y3J3LzRpYTBqeDJy
S1NlUGlzaGVQTUx1SmpnWkhuRVR0cjJ2VlBBYzJXMWwKdE8wczh6TnJIYlBmTWNM
WVdMQVhtYWFaeHJSM25QdzQ0ZGE0Q204N3RTdlRNUTJLVld1NEE1WVVyWVFLclBr
QgpzTEtYWG1GeGVyNWIvdjNRWUsyaDBuRWRKOGloMS8zNVdFbHk4bzBDZ2dFQWNM
RVdWK25TeUk0cSs2LzhLYnh4CkxWZGRCM2wvWW15cHNQRlZ6MGRzR1ZYZk82UTY0
U1RJbTNWR3pkejZwYVhleG05cWQvWTRDaWJEQzRDVFYya3gKRHdnT1V6QmhoOWhn
N3hLajZaelI2Y3BNU0xPcW1NaG5IVlZBakZCQ0VmUmJFdEd6SjI0M09ZSFJuWndt
NEtQMQpteTBwSXRtSFJGaU8yNytpU1pLWU1QdHdoOFZLdTBjVTZnTHc4YjhaUXZx
aHZZRzJUZjBBdnY5YW1xclUvOTkyCjRLcEhRZmhjVkp0Z0l6aXRVemF3bjZUWXFD
MHFSUHY0L3FyQWk4bG5JS0JIWlFiYnRtMFRQclVFWVVIVUZkdzkKM0tyOTNEQzQ3
MmlNblpQMkhPU0Z3R1R2UUVRM0NFdzBYRTVGczIrYzcxWmNGWk9jTzVScnorTWFm
dlRiYzgvWApJUUtDQVFCT0l3Vk9oL3d3REpnWHc5Y3V6ckVkWHIyODg2d2FCa0M4
aU04emdRUVpaUlFWTWtBUTlHRWFleCt4CkthVEg3THpNZ295NTAyam9tR1FEWXlF
TEIvc3Q2VXV0MmxOUkZEZjkvbmlWcXZ2Q3BHNGFSb1EyYzhVblE2WVMKUmtZazJa
VmtSYUwrcjRGdmJuMWoxSm9mUzNtZmJYVlJKODNkazdOWVdZSTFKMXZ6cHdCYkpj
eXV5a25Zd3ljZgpFdHFYQUxCa3NKZHc1VTIzV0ZrNUJ3bGp4NWZ3aTV1U1BDT2lt
Z004WDNaOU9SRDVOcmY4VGh5Mkt2TnJJRjlxCk1yL1NrWkgzeVF1OUx4ZURDaEpR
RHJHaTEzWVRHYUw4ZWoyaDhFeVJSWnM4WGYzdUw3OUl1d0wwZUVZblc4aUQKbGd1
N3Uza0txWVhGZlNJNHp0Um5RMzFaeDNtNwotLS0tLUVORCBQUklWQVRFIEtFWS0t
LS0tCg==
-----END PRIVATE KEY-----`;

    const options = {
      client_id: "1",
      username: "username",
      privateKey,
      validate: async function (result) {
        return !!result.access_token;
      },
      onclose: function () {
        console.log("Widget closed");
      },
    };

    // initialize bot only after external script loads
    const interval = setInterval(() => {
      if (window.PZRobot) {
        const bot = new window.PZRobot(options);
        bot.open();
        clearInterval(interval);
      }
    }, 100);

    return () => clearInterval(interval);
  }, []);

  return (
    <>
      <Script src="https://pz-script.vercel.app/agent/agent_script/pz-robot.js" strategy="afterInteractive" />
    </>

  );
}
