import { useEffect } from "react";
import Script from "next/script";

export default function PZRobotWidget() {
  useEffect(() => {
    const storedAgentType = sessionStorage.getItem("agentType");
    let agentType = storedAgentType || "agent1";

    const select = document.getElementById("agentImg");
    if (select && storedAgentType) {
      select.value = storedAgentType;
    }

    const privateKey = `-----BEGIN PRIVATE KEY-----
LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRZ0lCQURBTkJna3Foa2lH
OXcwQkFRRUZBQVNDQ1N3d2dna29BZ0VBQW9JQ0FRQzhZUmFhcFAzQ3hxeSsKdDY3
amJpeHlrZjJZZnAxM2FLcjRLVWoyWWlFb1B6cmlPNUVhK3AydFB6S1dCRTQ0REZ0
dTNmTTRrUUVjcjRtZAo1SGdjbHlQdTE3WXBxSmxKdUVybWdTbG5kUTVJQlZQdGh2
NGwyMURtRCtUVDRqMCtGSW5Bby8yYzFPSFU0NWFFCmJXWE5kczJtMmNzdmJPZ1ZG
Z09IZmtBWExVRHA3MDZPa0Y0bU9adGJvOFRwbG9vRmFwbjZCNzFkTWdlVzJHMTAK
cUo0eGZWNlgzUTUvSjBkYmUwbC9JQzc2VzRBeCswZW5xRnlLdmZlWlJBaDVaV0V2
a1BxemhmVkE5Mk5NSjFrQQpiM1lHM2VqOWw2Wkk2aG5wRFVYbGdRZEhYa1l3VklW
NmNOUkdid2NySXJGRm0wYmNWYkhBdHczWUZsTWJEREI4CkdhRWJKa2RTN0xpN1Ru
VmsxeTRUUHFOQzd5dGIyYjVHS3ZYVmFhZ2pseFAxdjF4ZEhEa29wWW9Uclc3RGx6
UjQKa2lVK2xadXo2eW1sb3JBSUhDOUNDWE1GMTdpMmZma0Z1YWM5elZVWmk0TDdo
bVloQ2I1dE9OYzFVWDhWK0N1TgpqUW91b3JVS2lKQWdJRnluOUpjTklhZ2lIOGI0
eWV3Tm1MZlVNdU9US2JrLzlDRFkyTjJOMkJuZmFrNkNFQ0hlCkUzVjAydCtWTStJ
cU5vYm44aHZGQkJYUnA4UGpFM0tOcmFJSS8wZStVT29zenJRL1dpVVQ0NGFnak1v
cDd6bVUKcTRTVXNkbGFXNmxMZVkxbXoxL1ZDSmNldGNsTy9oMERvSktBbSt6QkZN
RXlFdldsWGQ4K1JnK0FSTjQvcEQxUwphdDZkV2RWbDRqN1FneVRLRTYxbHZTTnVx
Ymg2RndJREFRQUJBb0lDQUEwYXQrYlVHVzhHUVJnWFVRd3pLdFpoCmY0R3ZOU2NN
V2ZCZmR0cms0cWVaRm5DTWNrQ3ROSERMMTZvRjdLY0xmUVRPWGRBT2prUS9sZFF0
QTRvQm5aZE0KM0RnenFVNHVpczlVSnR3eWtXYkRNQjV5NkpVYmw1b1pldktlWjJJ
OUxZUUFKSEZYZ2NvOGRza0pqeTVtMkZHRwpEeE5pZ1JhT2JIcHRkdW5sMVFFeEM0
YnhWZ3RVc0pFRWFIdFRaSkNSNU5vMjFaNTVEM3dYM0Mxa1dYVFo0czJ2CnJBVita
d0ZmSnpLM3UyemhGcDdqZXcyWHNiQlpITE5GdjAwcWwwTW0wN25QVk10TEtsWXUy
b3NrTmRLdWR6bkUKNWVWbW01elJ0bzRMbHNVSk10ckQxbkU1RGh0RU4veHhNbUhF
Tm42M1cyRXJtc1B3Y2FHTkRJWmxoZ2FNZUNPVwp4QnhSSEV1cXVGUmFVL0pycnB6
QUJiY3VzVkZGcVdaSEN5Q0tZVWNQbjlNeGlnV1BBc3dtcmcyRnpUUDBXQXkzCmZZ
Zm41VVlGMUZNUlJpdERjbmFSdDRwWkQveW15WUNZWFlPTEhCUVk4Zm9HZVZKWWtY
T05BYU9rMzloSEFDMlMKeFlYbXpua2Ivc083VitZelk0OWVhdlV3Wk9tVmxaL0gr
eFlwRGtZTFp4M29WYk52eVJoeWdzYUZJcDJycmlHUQpWS3BoMXNPd3pQeTd3TlhS
VnpyNUJYbW5SdWVJMXQ2TTdnSGVMTmJma0Y1YnFxeXhUUUloSHp0TStZRUtRMnZL
CkhmNEtoRmFMbW1LR00wUkdJM1RmR3htT3NBWWh0UlpvNXhVZDRPejNZek1KRWd2
WHpsMWlOMU9VQ3lzb1E2c24KYUFKVW9uTEw2NlpCWEQzcEhQQWhBb0lCQVFEOWE2
TVp6UnRqUy9peUdBam15a2FMa215NStrV1Rhc045SXljZwo0TTVkU1hqZ1QzZndX
S0tQM2hZRUdtVXNaTkxTZ2dCZEhuSG1raUVMd1k1bU9QT3RmL1l2RkRhWXdqWkVK
b29OCnE3cHhuUldmZ3pkRkc3NVkrSEhadXVydXBuQzdtaWx6RTdTYitQaThKSFB5
NjVLam0xV2Z1ejl0c1RadW9wWlEKUUxHeGMySkZFbXp6SGxaaTNGd0w0ZWM0Tzg4
S3lzY2IyL1ZQaHFGM1ZKNDFrbnFGYnh2Y3J3eWdEaWo0c0F1TQpFYkVaQ2FQb2s2
dzVXbUZzMDM3TUxtWjdmUDFIVURDOWN1SDhSK0xSWnVqMGJ0aHhJY0ZJekVBOFZv
T0x1YUtNCjlRT0NpWmtTVytFVFZNSkozWXpEbE5uclcxSTNSOE8xTmcvV25uZHFN
RGtTUkYxUkFvSUJBUUMrUy9lRExqazUKUXBIa2hLdkRRT0lydVRyMG9mRzJUcXlB
RDBQa3ZXWmdxWS9wVXJFK1JoTUZGSE5MNlBKZVE2MitFUlA3R2FZMQpDR0xoYjJh
ZWZpR3p4ZEZZc1NSY2ZWd2djUEd3YytyamU2TW50amFvRGZ2SlhCQXBDTWpMT1Bh
OGNrM09yTDBUCmpvcHNZcjZPUFRzR2tobzRVamNVYXB0T20rZXVTNjMrbzRweWJT
Y0dkYnNPZy9LdFJuZHdPY3pmZGx0K3g1eXcKbFNvL0hxbS85alMyTVpCdTduS3pO
T2FiM0JYb1B1SEpicWo1Sm50OG5RU2tQUkg4ZmFldkFjbFB4Uk8rUmJKZQpJYWRH
YXR6bUpnUVVlcjZlNHgvRGhyeFVHeWdtQ1FINCtVNThzZzN2VWtmclVnYTJzQ3l4
aUcydEpWV25pVmtFCmZNL1ZJK0RrdW1ibkFvSUJBUURBVkJKaW9JRnFxTnZEL2Uy
emlreGozT3JiY28rZlErVzljUkpmSjM0MjJtMzgKZnhOZHUwY1V2TTRrcXd1aDE1
c1EzRXorWHY2K3FLU2YwWFFMTEtuelFTeExxcUdNNmNoWmpJNDF0ZUU0SEttdQpk
OTFZZTZmSXlqVk5zMGhkZXNBUUFQMzRNanBlTFdSSkZibFI0V3RXODZyV0lUd1FP
ZkEvb3ZGRlV2UUk0ckx3CkRQM1d2VzErZGhMOWlhTDcwSmhmYm1vU1FLczZnY2pG
VWRrSWUzUzFGQkFuT2tyd3BnNStQczFrcm9DanFlZFYKdWMxNWNaaURDVGd3S2Y3
cE5ZRGJ3SVpkSVhWVkRCR2VMdVlackk1anZlUjlKVmFTOUcyOWUxTmNldzhBNFFE
bApLQW4zcTlvUVNTNXR1T2h5Y01wQzNob3Z5eW5XRGtvK3N2NTlXSmtoQW9JQkFF
alA0R0M5S3dBUnpLalhhckZHCi9rTWttTDVKeUthczY2d0VLMEkyaGhtdVIzWkxR
YTVHT2JqVDNsbkpSQk4xYWVFenY2VndadndidlZuc3VpTWkKdDlxRmNsaXhUdXhr
dXY5ZXQ5dUFQdnZUcnRYZkRvSzI5d1JReVk0cDRrcC8vVWlWbzlmVW1IUUhNa2ZP
Y0lNVQpRcVY4K2JOYkllQVorbHJWcEl3NFFOY1IxRU44S0ZaOGJacGNPbHE2ZjdE
ZExOckQrclpEd2x4K2RxKzRGOU52CmJUUFpPeDUyOWtSRGxZbEZhTXg0WXdRajUx
dU5zZW80V2pKTmU3aFVpL2lXZ21TWFQ3cWFDR21rRHRFT3luNzEKUk5KaE5OYXVx
TlN6bFJQSllFOU5Xd2Zjdkg5UjBhc2tuSWdaMXAvSVFSR2MxZnBPTXJ2ci9iZU4y
aWYvbG1sdQpPVGtDZ2dFQVhMdHg4QlI3bDIzM1RxOVBiUFl3SGNsR0sxT2Z3c1Iv
YlFoOFR0T0E2cWR1ZldhYnREaWdxVWp1CkE5bzJZVFp3dXhKZG94bEYwbVNsVXdF
NVgxMGNld2FjTm1Ta3Y3SXd5ZjFiUEhpR0hzVjlEUEh4Zk4xMGFWYjUKamZlV3kx
Rkg1M1I1RFRleUFQT3haTVZWWmd0Y3lxTzFqYTMrNlNOdEtpT3lGL3A1WXNkZmlG
UkVuTjNSMCtVNQpSQjZTRXJrRUJlaE05VFp1YmZUMXFPRmRqaFFyd3cvS2J4b1l5
KzdoMUNoWTlTTFBaNjAzZkE2SlRsSGhJLzg4Ck5tcWsvT0xjVXZzU2ltaThxTWtQ
WXNubCtaMUhUcHM2UFF6MTFqRUZUc2YzM2JnVXpoWFJEUStFZEN4QTZ3VEUKeFdJ
LzZ4UGNYdXI4cS85WkRlWWFESVl1RGFBanB3PT0KLS0tLS1FTkQgUFJJVkFURSBL
RVktLS0tLQo=
-----END PRIVATE KEY-----`;

    const options = {
      client_id: "1",
      username: "username",
      privateKey,
      validate: async function (result) {
        return !!result.access_token;
      },
      onclose: function () {
        console.log("Widget closed");
      },
    };

    // initialize bot only after external script loads
    const interval = setInterval(() => {
      if (window.PZRobot) {
        const bot = new window.PZRobot(options);
        bot.open();
        clearInterval(interval);
      }
    }, 100);

    return () => clearInterval(interval);
  }, []);

  return (
    <>
      <Script src="https://pz-script.vercel.app/agent/agent_script/pz-robot.js" strategy="afterInteractive" />
    </>

  );
}
